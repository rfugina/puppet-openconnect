description "openconnect vpn client daemon"

start on runlevel [2345]
stop on runlevel [!2345]

respawn
respawn limit 5 120

<% if @dnsupdate == false -%>
env DNS_UPDATE=no
export DNS_UPDATE
<% end -%>

exec cat /etc/openconnect/network.passwd | openconnect \
  <%= @url -%> \
  --syslog \
  --no-dtls \
  --script '<%= @script %>' \
<% unless @cacerts.empty? -%>
  --<%= @cafileparam %> /etc/openconnect/network.cacerts \
<% end -%>
<% if @authgroup -%>
  --authgroup=<%= @authgroup %>
<% end -%>
<% unless @servercert.empty? -%>
  --servercert <%= @servercert -%> \
<% end -%>
<% unless @proxy.empty? -%>
  --proxy="<%= @proxy %>" \
<% end -%>
  --user '<%= @user -%>' \
  --passwd-on-stdin
